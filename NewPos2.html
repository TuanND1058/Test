<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Textarea Functions</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js" integrity="sha512-YHQNqPhxuCY2ddskIbDlZfwY6Vx3L3w9WRbyJCY81xpqLmrM6rL2+LocBgeVHwGY9SXYfQWJ+lcEWx1fKS2s8A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

</head>
<style>
body{
    font-size: 12px;
}

.non-resize-textarea {
    overflow: hidden;
    resize: none;
    line-height: 1.929;
    height: 33px;
}

.preview {
    position: sticky;
    top: 15px;
    max-height: 500px;
    overflow-y: auto;
    text-align: center;
    border: 1px solid gray;
    padding: 5px 10px;
}

textarea {
    font-family: 'Courier New', Courier, monospace;
}

table, th, td {
    border: 1px solid black;
    border-collapse: collapse;
}

td {
    padding: 0 5px;
}

pre {
    font-family: 'Courier New', Courier, monospace;
    display: block;
    padding: 0;
    margin: 0;
    font-size: 14px;
    border: transparent;
    background-color: transparent;
    line-height: 1.1;
    overflow: hidden;
    width: 100%;
}

.hl-normal {

}

.hl-bold {
    font-weight: bold;
}

.hl-double-h {
    transform: scaleY(2);
    transform-origin: top;
    margin-bottom: 12px;
}

.hl-double-w {
    transform: scaleX(2);
    transform-origin: left;
    width: 50%;
}

.hl-double-wh {
    transform: scale(2);
    transform-origin: top left;
    width: 50%;
    margin-bottom: 12px;
}

label {
    margin: 0;
}

label:has(input[type="radio"]:disabled) {
    color: #797979;
}
</style>
<body>

<br>

<div class="container">
<div class="row">
    <div class="col-md-8" style="background-color: #dddddd;">
        <div class="row">
            <div class="col-md-5">
                <div style="margin-bottom: 23px;">Print Line</div>
                <textarea class="non-resize-textarea" id="txtInputText" rows="1" cols="41"></textarea>
            </div>
            <div class="col-md-7" style="background-color: #ffc9c9;">
                <table id="tblOptions">
                    <thead>
                        <tr>
                            <th>
                                Alignment
                                <br/>
                                <label><input type="radio" name="alignmentAll" value="0">Left</label>
                                <label><input type="radio" name="alignmentAll" value="1">Center</label>
                                <label><input type="radio" name="alignmentAll" value="2">Right</label>
                            </th>
                            <th>
                                Highlight
                                <br>
                                <select name="highlightAll" id="highlightAll">
                                    <option value="">---</option>
                                    <option value="0">Normal</option>
                                    <option value="1">Bold</option>
                                    <option value="2">DoubleH</option>
                                    <option value="3">DoubleW</option>
                                    <option value="4">DoubleWH</option>
                                </select>
                            </th>
                            <th>
                                Etc
                                <br>
                                <select name="etcAll" id="etcAll">
                                    <option value="">---</option>
                                    <option value="0">Normal</option>
                                    <option value="1">Gift Code</option>
                                    <option value="2">Barcode</option>
                                </select>
                            </th>
                            <th>
                                EJS
                                <br>
                                <select name="ejsAll" id="ejsAll">
                                    <option value="">---</option>
                                    <option value="0">Normal</option>
                                    <option value="1">None</option>
                                    <option value="2">EJS only</option>
                                </select>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr id="seq001" data-seq="001">
                            <td>
                                <label><input type="radio" name="alignment001" value="0" checked>Left</label>
                                <label><input type="radio" name="alignment001" value="1">Center</label>
                                <label><input type="radio" name="alignment001" value="2">Right</label>
                            </td>
                            <td>
                                <select name="highlight001" id="highlight001">
                                    <option value="0" selected>Normal</option>
                                    <option value="1">Bold</option>
                                    <option value="2">DoubleH</option>
                                    <option value="3">DoubleW</option>
                                    <option value="4">DoubleWH</option>
                                </select>
                            </td>
                            <td>
                                <select name="etc001" id="etc001">
                                    <option value="0" selected>Normal</option>
                                    <option value="1">Gift Code</option>
                                    <option value="2">Barcode</option>
                                </select>
                            </td>
                            <td>
                                <select name="ejs001" id="ejs001">
                                    <option value="0" selected>Normal</option>
                                    <option value="1">None</option>
                                    <option value="2">EJS only</option>
                                </select>
                            </td>
                        </tr>
                        <tr id="seq002" data-seq="002">
                            <td>
                                <label><input type="radio" name="alignment002" value="0" checked>Left</label>
                                <label><input type="radio" name="alignment002" value="1">Center</label>
                                <label><input type="radio" name="alignment002" value="2">Right</label>
                            </td>
                            <td>
                                <select name="highlight002" id="highlight002">
                                    <option value="0" selected>Normal</option>
                                    <option value="1">Bold</option>
                                    <option value="2">DoubleH</option>
                                    <option value="3">DoubleW</option>
                                    <option value="4">DoubleWH</option>
                                </select>
                            </td>
                            <td>
                                <select name="etc002" id="etc002">
                                    <option value="0" selected>Normal</option>
                                    <option value="1">Gift Code</option>
                                    <option value="2">Barcode</option>
                                </select>
                            </td>
                            <td>
                                <select name="ejs002" id="ejs002">
                                    <option value="0" selected>Normal</option>
                                    <option value="1">None</option>
                                    <option value="2">EJS only</option>
                                </select>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div id="divPreview" class="col-md-4 preview">
        <pre>태그의 각 줄 미리보기</pre>
        <pre>태그의 각 줄 미리보기</pre>
    </div>
</div>
</div>

<script>

// initialize common variable
var barcode = '[barcode]';
var sizePerLine = 40;
var printLines = [];
var optionAll = {
    alignment: '',
    highlight: '',
    etc: '',
    ejs: ''
};
var editingInfo = {
    previousLine: 1,
    currentLine: 1,
    rowCount: 1
};
var dataDetail = [
    {
        seq: '001',
        textOrigin: '',
        buffer: ' ',
        alignment: '0',
        highlight: '0',
        etc: '0',
        ejs: '0'
    }
];

$(document).ready(function(){

    // call the function to update the table with the initial preview
    fnRenderRowHeadTable('#tblOptions thead');
    fnRenderRowBodyTable('#tblOptions tbody');
    fnRenderPreviewDetail('#divPreview');

    $('#txtInputText').on('input', function() {
        fnAutoNewlines('#txtInputText');

        fnSetEditingInfo('#txtInputText');

        fnRenderRowBodyTable('#tblOptions tbody');

        fnRenderPreviewDetail('#divPreview');

        console.log(dataDetail);
    });

    $('#tblOptions thead').on('change', 'input[type="radio"], select', function() {
        var row = $(this).closest('tr');

        fnUpdateAllOptionsDetail(row);

        fnUpdateAllRowDetailTable(row);

        fnRenderRowBodyTable('#tblOptions tbody');

        fnRenderPreviewDetail('#divPreview');

        console.log(dataDetail);
    });

    $('#tblOptions tbody').on('change', 'input[type="radio"], select', function() {
        var row = $(this).closest('tr');

        fnUpdateOptionsDetail(row);

        fnUpdateRowDetailTable(row);

        fnRenderRowHeadTable('#tblOptions thead');

        fnRenderPreviewDetail('#divPreview');

        console.log(dataDetail);
    });

    $('#txtInputText').on('click', function() {
        var currentLine = fnGetCaretPosition('#txtInputText');
        editingInfo.previousLine = currentLine;
        editingInfo.currentLine = currentLine;
    });

});

function debounce(func, delay) {
    var timer;
    return function() {
        var context = this;
        var args = arguments;
        clearTimeout(timer);
        timer = setTimeout(() => {
            func.apply(context, args);
        }, delay);
    };
}

///
/// fnUpdateAllOptionsDetail
///
function fnUpdateAllOptionsDetail(row) {
    // get element row detail
    var alignmentAllElement = row.find('input[type="radio"]');
    var highlightAllElement = row.find('select').eq(0);
    var etcAllElement = row.find('select').eq(1);
    var ejsAllElement = row.find('select').eq(2);

    // get value
    var alignmentAll = alignmentAllElement.filter(':checked').val();
    var highlightAll = highlightAllElement.val();
    var etcAll = etcAllElement.val();
    var ejsAll = ejsAllElement.val();

    var a = row.data('seq');

    optionAll.alignment = alignmentAll;
    optionAll.highlight = highlightAll;
    optionAll.etc = etcAll;
    optionAll.ejs = ejsAll;

    dataDetail.forEach(function(data) {
        data.alignment = optionAll.alignment || '0';
        data.highlight = optionAll.highligh || '0';
        data.etc = optionAll.etc || '0';
        data.ejs = optionAll.ejs || '0';

        var textFormat = fnFormatText(data.textOrigin, data.alignment, data.highlight, sizePerLine);

        data.textOrigin = textFormat.textOrigin;
        data.buffer = textFormat.text;
    });
}

///
/// fnUpdateOptionsDetail : updated text formatting options in data array
///
function fnUpdateOptionsDetail(row) {
    // get element row detail
    var alignmentElement = row.find('input[type="radio"]');
    var highlightElement = row.find('select').eq(0);
    var etcElement = row.find('select').eq(1);
    var ejsElement = row.find('select').eq(2);

    // get value
    var alignment = alignmentElement.filter(':checked').val();
    var highlight = highlightElement.val();
    var etc = etcElement.val();
    var ejs = ejsElement.val();

    // reset option all
    if (optionAll.alignment && optionAll.alignment !== alignment) {
        optionAll.alignment = '';
    }
    if (optionAll.highlight && optionAll.highlight !== highlight) {
        optionAll.highlight = '';
    }
    if (optionAll.etc && optionAll.etc !== etc) {
        optionAll.etc = '';
    }
    if (optionAll.ejs && optionAll.ejs !== ejs) {
        optionAll.ejs = '';
    }

    var seq = row.data("seq");
    var data = dataDetail.find(item => item.seq === seq);
    var textFormat = fnFormatText(data.textOrigin, alignment, highlight, sizePerLine);

    data.textOrigin = textFormat.textOrigin;
    data.buffer = textFormat.text;
    data.alignment = alignment || '0';
    data.highlight = highlight || '0';
    data.etc = etc || '0';
    data.ejs = ejs || '0';
}

///
/// fnUpdateAllRowDetailTable : updated status for row
///
function fnUpdateAllRowDetailTable(row) {
    // get element row detail
    var alignmentAllElement = row.find('input[type="radio"]');
    var highlightAllElement = row.find('select').eq(0);
    var etcAllElement = row.find('select').eq(1);
    var ejsAllElement = row.find('select').eq(2);

    // get value
    var alignmentAll = alignmentAllElement.filter(':checked').val();
    var highlightAll = highlightAllElement.val();
    var etcAll = etcAllElement.val();
    var ejsAll = ejsAllElement.val();

    dataDetail.forEach(function(data) {
        data.alignment = alignmentAll || '0';
        data.highlight = highlightAll || '0';
        data.etc = etcAll || '0';
        data.ejs = ejsAll || '0';

        // gift code
        if (etcAll === '1') {
            data.alignment = '1';
            data.highlight = '0';
        }

        // barcode
        if (etcAll === '2') {
            data.buffer = barcode;
            data.highlight = '0';
        }
    });
}

///
/// fnUpdateRowDetailTable : updated status for row
///
function fnUpdateRowDetailTable(row) {
    // get element row detail
    var alignmentElement = row.find('input[type="radio"]');
    var highlightElement = row.find('select').eq(0);
    var etcElement = row.find('select').eq(1);
    var ejsElement = row.find('select').eq(2);

    // get value
    var etc = etcElement.val();

    var seq = row.data("seq");

    var data = dataDetail.find(item => item.seq === seq);

    // set enable options
    alignmentElement.prop('disabled', false);
    highlightElement.prop('disabled', false);

    // gift code
    if (etc === '1') {
        alignmentElement.prop('disabled', true);
        highlightElement.prop('disabled', true);

        data.alignment = '1';
        data.highlight = '0';
    }

    // barcode
    if (etc === '2') {
        alignmentElement.prop('disabled', true);
        highlightElement.prop('disabled', true);

        data.buffer = barcode;
        data.highlight = '0';
    }
}

///
/// fnRenderRowHeadTable : create a table containing text format options
///
function fnRenderRowHeadTable(idElement) {
    $(idElement).empty();

    var data = optionAll;

    var newRow = '' +
        '<tr>' +
            '<td>Alignment<br/>' +
                '<label><input type="radio" name="alignmentAll" value="0" ' + (optionAll.alignment === '0' ? 'checked' : '') + ' ' + (optionAll.etc && data.etc !== '0' ? 'disabled' : '') + '>Left</label>' +
                '<label><input type="radio" name="alignmentAll" value="1" ' + (optionAll.alignment === '1' ? 'checked' : '') + ' ' + (optionAll.etc && data.etc !== '0' ? 'disabled' : '') + '>Center</label>' +
                '<label><input type="radio" name="alignmentAll" value="2" ' + (optionAll.alignment === '2' ? 'checked' : '') + ' ' + (optionAll.etc && data.etc !== '0' ? 'disabled' : '') + '>Right</label>' +
            '</td>' +
            '<td>Highlight<br/>' +
                '<select name="highlightAll" ' + (optionAll.etc && optionAll.etc !== '0' ? 'disabled' : '') + '>' +
                    '<option value="" ' + (optionAll.highlight === '' ? 'selected' : '') + '>---</option>' +
                    '<option value="0" ' + (optionAll.highlight === '0' ? 'selected' : '') + '>Normal</option>' +
                    '<option value="1" ' + (optionAll.highlight === '1' ? 'selected' : '') + '>Bold</option>' +
                    '<option value="2" ' + (optionAll.highlight === '2' ? 'selected' : '') + '>DoubleH</option>' +
                    '<option value="3" ' + (optionAll.highlight === '3' ? 'selected' : '') + '>DoubleW</option>' +
                    '<option value="4" ' + (optionAll.highlight === '4' ? 'selected' : '') + '>DoubleWH</option>' +
                '</select>' +
            '</td>' +
            '<td>Etc<br/>' +
                '<select name="etcAll">' +
                    '<option value="" ' + (optionAll.etc === '' ? 'selected' : '') + '>---</option>' +
                    '<option value="0" ' + (optionAll.etc === '0' ? 'selected' : '') + '>Normal</option>' +
                    '<option value="1" ' + (optionAll.etc === '1' ? 'selected' : '') + '>Gift Code</option>' +
                    '<option value="2" ' + (optionAll.etc === '2' ? 'selected' : '') + '>Barcode</option>' +
                '</select>' +
            '</td>' +
            '<td>EJS<br/>' +
                '<select name="ejsAll">' +
                    '<option value="" ' + (optionAll.ejs === '' ? 'selected' : '') + '>---</option>' +
                    '<option value="0" ' + (optionAll.ejs === '0' ? 'selected' : '') + '>Normal</option>' +
                    '<option value="1" ' + (optionAll.ejs === '1' ? 'selected' : '') + '>None</option>' +
                    '<option value="2" ' + (optionAll.ejs === '2' ? 'selected' : '') + '>EJS only</option>' +
                '</select>' +
            '</td>' +
        '</tr>';

    $(idElement).append(newRow);
}

///
/// fnRenderRowTable : create a table containing text format options
///
function fnRenderRowBodyTable(idElement) {
    $(idElement).empty();

    // loop through the array and add new rows to the table
    dataDetail.forEach(function(data) {
        var newRow = '' +
            '<tr id="seq' + data.seq + '" data-seq="' + data.seq + '">' +
                '<td>' +
                    '<label><input type="radio" name="alignment' + data.seq + '" value="0" ' + (data.alignment === '0' ? 'checked' : '') + ' ' + (data.etc !== '0' ? 'disabled' : '') + '>Left</label>' +
                    '<label><input type="radio" name="alignment' + data.seq + '" value="1" ' + (data.alignment === '1' ? 'checked' : '') + ' ' + (data.etc !== '0' ? 'disabled' : '') + '>Center</label>' +
                    '<label><input type="radio" name="alignment' + data.seq + '" value="2" ' + (data.alignment === '2' ? 'checked' : '') + ' ' + (data.etc !== '0' ? 'disabled' : '') + '>Right</label>' +
                '</td>' +
                '<td>' +
                    '<select name="highlight' + data.seq + '" ' + (data.etc !== '0' ? 'disabled' : '') + '>' +
                        '<option value="0" ' + (data.highlight === '0' ? 'selected' : '') + '>Normal</option>' +
                        '<option value="1" ' + (data.highlight === '1' ? 'selected' : '') + '>Bold</option>' +
                        '<option value="2" ' + (data.highlight === '2' ? 'selected' : '') + '>DoubleH</option>' +
                        '<option value="3" ' + (data.highlight === '3' ? 'selected' : '') + '>DoubleW</option>' +
                        '<option value="4" ' + (data.highlight === '4' ? 'selected' : '') + '>DoubleWH</option>' +
                    '</select>' +
                '</td>' +
                '<td>' +
                    '<select name="etc' + data.seq + '">' +
                        '<option value="0" ' + (data.etc === '0' ? 'selected' : '') + '>Normal</option>' +
                        '<option value="1" ' + (data.etc === '1' ? 'selected' : '') + '>Gift Code</option>' +
                        '<option value="2" ' + (data.etc === '2' ? 'selected' : '') + '>Barcode</option>' +
                    '</select>' +
                '</td>' +
                '<td>' +
                    '<select name="ejs' + data.seq + '">' +
                        '<option value="0" ' + (data.ejs === '0' ? 'selected' : '') + '>Normal</option>' +
                        '<option value="1" ' + (data.ejs === '1' ? 'selected' : '') + '>None</option>' +
                        '<option value="2" ' + (data.ejs === '2' ? 'selected' : '') + '>EJS only</option>' +
                    '</select>' +
                '</td>' +
            '</tr>';

        $(idElement).append(newRow);
    });
}

///
/// fnRenderPreviewDetail : create a <pre> tag for the preview
///
function fnRenderPreviewDetail(idElement) {
    var previewDiv = $(idElement);
    previewDiv.empty();

    dataDetail.forEach(function(data) {
        var preElement = $('<pre>').text(data.buffer || ' ');

        switch (data.highlight) {
            case '0':
                preElement.addClass('hl-normal');
                break;
            case '1':
                preElement.addClass('hl-bold');
                break;
            case '2':
                preElement.addClass('hl-double-h');
                break;
            case '3':
                preElement.addClass('hl-double-w');
                break;
            case '4':
                preElement.addClass('hl-double-wh');
                break;
            default:
                break;
        }

        previewDiv.append(preElement);
    });
}

// dang tam ko can
function fnGetDataAllTableValues(idElement) {
    var tableValues = [];

    // Lặp qua từng hàng (row) trong phần tbody của bảng
    $(idElement + ' tbody tr').each(function(index, row) {
        var rowData = {};

        rowData.seq = $(row).data('seq');
        rowData.alignment = $(row).find('input[name^="alignment"]:checked').val();
        rowData.highlight = $(row).find('select[name^="highlight"]').val();
        rowData.etc = $(row).find('select[name^="etc"]').val();
        rowData.ejs = $(row).find('select[name^="ejs"]').val();

        tableValues.push(rowData);
    });

    return tableValues;
}

///
/// fnGetCaretPosition : function to get cursor position
///
function fnGetCaretPosition(id) {
    var textarea = $(id);
    var text = textarea.val();
    var startPos = textarea[0].selectionStart;
    var currentLine = text.substring(0, startPos).split('\n').length;
    return currentLine;
}

///
/// fnAutoNewline : automatically wrap text when limit is reached
///
function fnAutoNewlines(idElement) {
    var textarea = $(idElement);
    var text = textarea.val();

    var startPos = textarea[0].selectionStart;
    var endPos = textarea[0].selectionEnd;

    var maxLength = sizePerLine;
    var lines = text.split('\n');
    for (var i = 0; i < lines.length; i++) {
        var line = lines[i];
        var cutTextSize = fnCutTextSize(line).text;
        maxLength = cutTextSize.length;

        // automatically breaks the line after the limit is reached
        if (line.length > maxLength) {
            var spacePos = line.lastIndexOf(' ', maxLength);

            if (spacePos !== -1) {
                lines[i] = line.substring(0, spacePos);
                lines.splice(i + 1, 0, line.substring(spacePos + 1));
            } else {
                lines[i] = line.substring(0, maxLength);
                lines.splice(i + 1, 0, line.substring(maxLength));
            }
        }
    }

    printLines = lines;

    var updatedText = lines.join('\n');
    textarea.val(updatedText);
    textarea.css('height', 'auto').height(textarea[0].scrollHeight);

    // restore cursor position
    textarea[0].setSelectionRange(startPos, endPos);

    // set current line after update
    editingInfo.currentLine = fnGetCaretPosition(idElement);
}

///
/// fnSetEditingInfo : check whether lines are added or subtracted and do the work accordingly
///
function fnSetEditingInfo(idElement) {
    var textarea = $(idElement);
    var text = textarea.val();
    var currentLine = fnGetCaretPosition(idElement);

    var rowCount = text.split('\n').length;
    var addedRows = rowCount - editingInfo.rowCount;

    // perform extra data when adding rows
    if (addedRows > 0) {
        fnAddRowsTable(addedRows);
    }

    // perform data deletion when deleting lines
    if (addedRows < 0) {
        fnDelRowsTable(addedRows);
    }

    // after adding or deleting lines, the array needs to be reset
    fnUpdateDataDetail();

    editingInfo.previousLine = fnGetCaretPosition(idElement);
    editingInfo.rowCount = rowCount;
}

///
/// fnAddRowsTable
///
function fnAddRowsTable(addedRows) {
    var preLine = editingInfo.previousLine;

    for (var i = 0; i < addedRows; i++) {
        var start = preLine;
        preLine += 1;
        var seq = ('00' + preLine).slice(-3);
        var data = {
            seq: seq,
            textOrigin: '',
            buffer: ' ',
            alignment: optionAll.alignment || '0',
            highlight: optionAll.highlight || '0',
            etc: optionAll.etc || '0',
            ejs: optionAll.ejs || '0'
        }
        dataDetail.splice(start, 0, data);
    }
}

///
/// fnDelRowsTable
///
function fnDelRowsTable(addedRows) {
    var curLine = editingInfo.currentLine;

    var start = curLine;
    var deleteCount = Math.abs(addedRows);

    dataDetail.splice(start, deleteCount);
}

///
/// fnUpdateDataDetail : update sequence and text information
///
function fnUpdateDataDetail() {
    for (var i = 0; i < dataDetail.length; i++) {
        var data = dataDetail[i];
        var printLine = printLines[i];

        var buffer = fnFormatText(printLine, data.alignment, data.highlight, sizePerLine);

        data.seq = ('00' + (i + 1)).slice(-3);
        data.textOrigin = buffer.textOrigin;
        data.buffer = data.etc === '2' ? barcode : buffer.text;
    }
}

///
/// fnCutTextSize : perform string slicing
/// params: <txtInput> : text on line
/// return {
///    text: result, : text after cutting
///    length: count : used for formatting in function fnFormatText
/// };
function fnCutTextSize(txtInput) {
    var result = '';
    var count = 0;
    var array = txtInput.split('');

    // split text
    for (var i = 0; i < array.length; i++) {
        var char = array[i];
        // used for the English alphabet = 1; used for Korean text length = 3
        var length = new Blob([char]).size;
        count += (length > 2 ? 2 : 1);
        if (count > sizePerLine) {
            break;
        }
        result += char;
    }

    return { text: result, length: count};
}

///
/// fnFormatText : perform string slicing and text formatting according to options
/// params:
///    <txtInput>  : text on line
///    <alignment> : values('0', '1', '2')
///    <highlight> : values('0', '1', '2', '3', '4')
///    <width>     : maximum size per line
/// return {
///    text: result,          : text is formatted according to alignment and alignment
///    textOrigin: textOrigin : original text
/// }
///
function fnFormatText(txtInput, alignment = '0', highlight = '0', width = 40) {
    var array = txtInput.split('');

    // DoubleW
    if (highlight === '3') {
        width = Math.floor(width / 2);
    }

    // DoubleWH
    if (highlight === '4') {
        width = Math.floor(width / 2);
    }

    var cutTextSize = fnCutTextSize(txtInput);
    var textOrigin = cutTextSize.text;
    var result = cutTextSize.text;
    var count = cutTextSize.length;

    // Calculate the length of the missing space
    var widthSpace = width - count < 0 ? 0 : width - count;

    // Left alignment
    if (alignment === '0') {
        for (var i = 0; i < widthSpace; i++) {
            result = result + ' ';
        }
    }

    // Center alignment
    if (alignment === '1') {
        for (var i = 0; i < Math.floor(widthSpace / 2); i++) {
            result = ' ' + result + ' ';
        }
        result += widthSpace % 2 === 0 ? '' : ' ';
    }

    // Right alignment
    if (alignment === '2') {
        for (var i = 0; i < widthSpace; i++) {
            result = ' ' + result;
        }
    }

    return { text: result, textOrigin: textOrigin };
}

</script>

</body>
</html>
